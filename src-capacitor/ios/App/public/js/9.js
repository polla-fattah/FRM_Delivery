(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{be05:function(e,r,i){"use strict";var t=i("cdb0"),d=i.n(t);d.a},cdb0:function(e,r,i){},d0e9:function(e,r,i){"use strict";i.r(r);var t=function(){var e=this,r=e.$createElement,i=e._self._c||r;return i("q-page",{staticClass:"column",attrs:{id:"page-show-driver"}},[i("q-card",[i("q-card-section",{attrs:{id:"detail"}},[i("div",{staticClass:"text-h4 text-center",staticStyle:{color:"#105783"}},[e._v(e._s(e.$t("driverDetail")))]),i("div",{staticClass:"driver-info text-subtitle2"},[i("div",{staticClass:"driver-info-input"},[i("q-input",{attrs:{"lazy-rules":"",outlined:"",label:e.$t("name"),rules:[function(r){return r&&r.length>0||e.$t("enterValidName")}]},model:{value:e.driverSend.name,callback:function(r){e.$set(e.driverSend,"name",r)},expression:"driverSend.name"}})],1),i("div",{staticClass:"driver-info-input"},[i("q-input",{attrs:{outlined:"",label:e.$t("mobile"),rules:[function(r){return r&&0==r.search(/^0[0-9]{10}$/)||e.$t("enterValidMobile")}],"lazy-rules":""},on:{blur:function(r){return e.fixMobile()}},model:{value:e.driverSend.mobile,callback:function(r){e.$set(e.driverSend,"mobile",r)},expression:"driverSend.mobile"}})],1),i("div",{staticClass:"driver-info-input"},[i("q-input",{attrs:{"lazy-rules":"",outlined:"",label:e.$t("car"),rules:[function(r){return r&&r.length>0||e.$t("enterValidCar")}]},model:{value:e.driverSend.car,callback:function(r){e.$set(e.driverSend,"car",r)},expression:"driverSend.car"}})],1)]),e.error?i("div",{staticStyle:{color:"red"}}):e._e()]),i("q-separator",{attrs:{dark:""}}),i("q-card-actions",{staticClass:"row justify-center",attrs:{id:"control"}},[i("q-btn",{attrs:{color:"secondary",label:e.$t("submit")},on:{click:function(r){return e.submit()}}}),e.driver?i("q-btn",{attrs:{color:"negative",label:e.$t("delete")},on:{click:function(r){e.confirm=!0}}}):e._e(),i("q-btn",{attrs:{color:"warning",label:e.$t("cancel")},on:{click:e.goBack}})],1)],1),i("q-dialog",{attrs:{persistent:""},model:{value:e.confirm,callback:function(r){e.confirm=r},expression:"confirm"}},[i("q-card",[i("q-card-section",{staticClass:"row items-center"},[i("q-avatar",{attrs:{icon:"highlight_off",color:"red","text-color":"white"}}),i("span",{staticClass:"q-ml-sm"},[e._v(e._s(e.$t("areYouSureDelete")))])],1),i("q-card-actions",{attrs:{align:"center"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:e.$t("yes"),color:"negative"},on:{click:e.deleteDriver}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:e.$t("no"),color:"primary"}})],1)],1)],1)],1)},d=[],n=(i("5319"),i("c973")),o=i.n(n),a=i("ded3"),s=i.n(a),l=i("2b0e"),c=(i("59ca"),i("032d")),u=l["a"].extend({name:"Editdriver",created(){this.driverSend=this.driver?s()({},this.driver):{},this.driver&&(this.driverSend.mobile=this.driver.mobile.replace("+964","0"))},props:["driver","regionIndx"],data(){return{driverSend:null,error:!1,confirm:!1}},computed:{region(){return this.$store.state.regions[this.regionIndx]}},methods:{fixMobile(){this.driverSend.mobile=this.$parseArabic(this.driverSend.mobile)},deleteDriver(){var e=this;return o()((function*(){try{const r=s()({},e.region);delete r.docid,delete r.id,r.drivers=r.drivers.filter(r=>r.userId!=e.driver.userId),console.log(e.region.docid),yield c["f"].doc(e.region.docid).set(r),e.$store.commit("updateRegion",{data:r,docid:e.region.docid})}catch(r){console.error(r)}e.goBack()}))()},getDriverId(e){var r=this;return o()((function*(){try{let i=yield c["h"].where("mobile","==",e).get();return i.size?i.docs[0].id:yield r.addNewUser(e)}catch(i){console.error(i)}}))()},addNewUser(e){var r=this;return o()((function*(){try{const r=yield c["h"].add({mobile:e,role:"driver"}),i=c["d"].httpsCallable("addRoles");return yield i({mobile:e,role:"driver"}),r.id}catch(i){console.error("Error adding document: ",i)}r.goBack()}))()},goBack(){this.$router.push({name:"EditRegion",params:{regionIndx:this.regionIndx}})},submit(){var e=this;return o()((function*(){if(""==e.driverSend.mobile)return void(e.error=!0);let r=s()({},e.region);delete r.docid,delete r.id,r.drivers||(r.drivers=[]),e.driverSend.mobile="+964"+e.driverSend.mobile.substr(1);try{if(e.driver){const i=r=>r.userId==e.driver.userId,t=r.drivers.findIndex(i);if(r.drivers[t].mobile!=e.driverSend.mobile){const r=yield e.getDriverId(e.driverSend.mobile);e.driverSend.userId=r}r.drivers[t]=e.driverSend}else{const i=yield e.getDriverId(e.driverSend.mobile),t=r=>r.mobile==e.driverSend.mobile,d=r.drivers.findIndex(t);-1==d?r.drivers.push(s()(s()({},e.driverSend),{},{userId:i,jobs:0})):r.drivers[d]=s()(s()({},e.driverSend),{},{userId:i})}yield c["f"].doc(e.region.docid).set(r),e.$store.commit("updateRegion",{data:r,docid:e.region.docid})}catch(i){console.error("Can not update drivers",i)}e.goBack()}))()}}}),v=u,b=(i("be05"),i("2877")),m=i("9989"),p=i("f09f"),f=i("a370"),g=i("27f9"),h=i("eb85"),S=i("4b7e"),$=i("9c40"),y=i("24e8"),q=i("cb32"),x=i("7f67"),I=i("eebe"),k=i.n(I),w=Object(b["a"])(v,t,d,!1,null,null,null);r["default"]=w.exports;k()(w,"components",{QPage:m["a"],QCard:p["a"],QCardSection:f["a"],QInput:g["a"],QSeparator:h["a"],QCardActions:S["a"],QBtn:$["a"],QDialog:y["a"],QAvatar:q["a"]}),k()(w,"directives",{ClosePopup:x["a"]})}}]);